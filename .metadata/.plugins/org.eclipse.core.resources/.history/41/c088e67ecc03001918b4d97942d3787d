package udp;
import java.net.*;
import java.io.*;
//import java.util.concurrent.TimeUnit;

public class UDPServer {

  public static void main (String args[]) {

    try {
      @SuppressWarnings("resource")
      DatagramSocket socketUDP = new DatagramSocket(6789);
      byte[] buffer = new byte[1000];

      while (true) {
    	  DatagramPacket request = new DatagramPacket(buffer, buffer.length);

        socketUDP.receive(request);

        byte[] data = new byte[request.getLength()];
        System.arraycopy(request.getData(), request.getOffset(), data, 0, request.getLength());
        String msg = new String (data);
        
        //System.out.println("MENSAJE DATA: " + msg);
        //System.out.println("STRING LENGTH: " + msg.length() + "\n");

        //JSONParser parser = new JSONParser();
        //JSONObject mensaje = (JSONObject) parser.parse(msg);

        System.out.print("Datagram received from host: " + request.getAddress());
        System.out.println(" from remote port: " + request.getPort());

        DatagramPacket response =
          new DatagramPacket(request.getData(), request.getLength(),
                             request.getAddress(), request.getPort());

//        System.out.println("Sleeping");
//        TimeUnit.SECONDS.sleep(30);
//        System.out.println("AWAKE");

        socketUDP.send(response);
      }

    } catch (SocketException e) {
      System.out.println("Socket: " + e.getMessage());
    } catch (IOException e) {
      System.out.println("IO: " + e.getMessage());
    } /*catch (InterruptedException e){
      System.out.println("IE: " + e.getMessage());
    } catch (ParseException e){
     System.out.println("PE: " + e.getMessage());
    }*/
  }
}